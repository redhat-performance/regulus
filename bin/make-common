#
# init:     init this dir one-time
# clean:    clear all artifact generated by init, but not run dirs
# run:      debug run directly here. Normal run should be invoked from $REG_ROOT/
#

ifndef REG_ROOT
$(error REG_ROOT is not set. Please 'source ./bootstrap.sh')
endif
include ${REG_ROOT}/jobs.config

# default TAG to "DRY". For make directly at the dir, but not from jobs.
TAG ?= DRY
RUN=reg-run

run:
	${RUN} --label ${TAG}

init:
	./reg_expand.sh

dry-run:
	DRY_RUN=true NUM_SAMPLES=1 OCP_PROJECT=crucible-hnhan ${RUN} --label DRY

wet-run:
	NUM_SAMPLES=1 OCP_PROJECT=crucible-hnhan ${RUN} --label ${TAG}

reindex:
	reindex --labels ${TAG}

clean:
	find . -maxdepth 1 \( -type f -o -type l \) ! \( -name "makefile" -o -name "reg_expand.sh" \) -exec rm -v {} +
	rmrun --label ALL

